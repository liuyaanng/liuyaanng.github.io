<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<link rel="icon" type="image/x-icon" href="favicon.ico" />
		<meta
			name="viewport"
			content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"
		/>
		<title>Tiktok🔞</title>
		<script type="text/javascript">
			if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
				//    window.location.href = "mobile_tiktok.html";
			} else {
				window.location.href = "pc_tiktok.html";
			}
		</script>
		<style type="text/css">
			* {
				margin: 0px;
				padding: 0px;
				touch-action: pan-y;
				text-align: center;
			}
			.app {
				width: 100%;
				height: 100%;
				position: absolute;
				top: 0px;
				right: 0px;
				bottom: 0px;
				left: 0px;
				overflow: hidden;
				background-color: #ffffff;
			}

			#player {
				width: 100%;
				height: 100%;
				object-fit: cover;
				object-position: center center;
				z-index: 100;
			}
		</style>

		<!-- Matomo -->
		<script type="text/javascript">
			var _paq = (window._paq = window._paq || []);
			/* tracker methods like "setCustomDimension" should be called before "trackPageView" */
			_paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
			_paq.push(["setCookieDomain", "*.godliuyang.wang"]);
			_paq.push(["trackPageView"]);
			_paq.push(["enableLinkTracking"]);
			(function () {
				var u = "https://godliuyangwang.matomo.cloud/";
				_paq.push(["setTrackerUrl", u + "matomo.php"]);
				_paq.push(["setSiteId", "1"]);
				var d = document,
					g = d.createElement("script"),
					s = d.getElementsByTagName("script")[0];
				g.type = "text/javascript";
				g.async = true;
				g.src = "//cdn.matomo.cloud/godliuyangwang.matomo.cloud/matomo.js";
				s.parentNode.insertBefore(g, s);
			})();
		</script>
		<!-- End Matomo Code -->
	</head>
	<body>
		<div class="app">
			<video
				id="player"
				preload
				autoplay
				webkit-playsinline="true"
				playsinline="true"
				x-webkit-airplay="true"
				x5-video-player-type="h5"
				x5-video-player-fullscreen="true"
				x5-video-ignore-metadata="true"
				controlslist="nodownload"
				poster="https://cdn.jsdelivr.net/gh/liuyaanng/Blog_source@master/blog_images/img/wallhaven-l33w72.jpg"
			></video>
		</div>

		<div id="buttons" style="position: absolute; bottom: 250px; right: 10px">
			<button id="yuan" style="border-radius: 20px; width: 32px; height: 32px">
				<a href="./mobile.html">DouYin</a>
			</button>
			<button style="border-radius: 20px; width: 48px; height: 32px" onclick="players();">
				PASS
			</button>
			<br /><br /><br />
		</div>

		<span
			style="position: absolute; top: 5px; right: 10px; color: #4682b4; font-size: 12px"
			id="userid"
			>@GeekOcean</span
		>

		<span style="position: absolute; bottom: 10px; left: 10px; color: #fff; font-size: 9px"
			>本程序仅作研究学习演示，数据采集自网络<br />原作者拍摄创作不易，请勿下载传播</span
		>
	</body>

	<script type="text/javascript" src="./js/jquery-1.11.0.min.js"></script>
	<script type="text/javascript" src="./js/jquery.cookie.min.js"></script>
	<script>
		$(document).ready(function () {
			let ourRequest = new XMLHttpRequest();

			let ourData;
			ourRequest.onreadystatechange = function () {
				if (ourRequest.readyState == 4 && ourRequest.status == 200) {
					ourData = JSON.parse(ourRequest.responseText);
					console.log(ourData);
					console.log(ourData.results[0]);
				}
			};

			ourRequest.open("GET", URL);
			ourRequest.send();
			auto = true;
			gi = 1;
			player = document.getElementById("player");
			players();

			player.addEventListener(
				"ended",
				function () {
					console.log("播放结束");
					console.log(auto);
					if (auto == false) {
						player.play();
					} else {
						players();
					}
				},
				false,
			);

			touchtime = new Date().getTime();
			$("#player").on("click", function () {
				if (new Date().getTime() - touchtime < 500) {
					console.log("dblclick");
					FullScreen();
				} else {
					touchtime = new Date().getTime();
					console.log("click");
					if (player.paused) {
						player.play();
					} else {
						player.pause();
					}
				}
			});
		});
		function getRandomInt(min, max) {
			min = Math.ceil(min);
			max = Math.floor(max);
			return Math.floor(Math.random() * (max - min)) + min; //不含最大值，含最小值
		}
		function players() {
			console.log("成功获取数据！");
			fetch("https://cdn.jsdelivr.net/gh/liuyaanng/douyin_resource@master/txt/toktik.json")
				.then(function (res) {
					return res.json();
				})
				.then(function (data) {
					obj = JSON.parse(data);
				})
				.catch(function (err) {
					console.error(err);
				});
			console.log(i);
			var i = getRandomInt(0, obj.length);
			player.src = obj[i].url;
			player.play();
		}

		//进入全屏
		function FullScreen() {
			if (player.requestFullscreen) {
				player.requestFullscreen();
				player.play();
			} else if (player.mozRequestFullScreen) {
				player.mozRequestFullScreen();
				player.play();
			} else if (player.webkitRequestFullScreen) {
				player.webkitRequestFullScreen();
				player.play();
			}
		}
	</script>
	<script>
		var startx, starty;
		//获得角度
		function getAngle(angx, angy) {
			return (Math.atan2(angy, angx) * 180) / Math.PI;
		}

		//根据起点终点返回方向 1向上 2向下 3向左 4向右 0未滑动
		function getDirection(startx, starty, endx, endy) {
			var angx = endx - startx;
			var angy = endy - starty;
			var result = 0;

			//如果滑动距离太短
			if (Math.abs(angx) < 2 && Math.abs(angy) < 2) {
				return result;
			}

			var angle = getAngle(angx, angy);
			if (angle >= -135 && angle <= -45) {
				result = 1;
			} else if (angle > 45 && angle < 135) {
				result = 2;
			} else if ((angle >= 135 && angle <= 180) || (angle >= -180 && angle < -135)) {
				result = 3;
			} else if (angle >= -45 && angle <= 45) {
				result = 4;
			}

			return result;
		}
		//手指接触屏幕
		document.addEventListener(
			"touchstart",
			function (e) {
				startx = e.touches[0].pageX;
				starty = e.touches[0].pageY;
			},
			false,
		);
		//手指离开屏幕
		document.addEventListener(
			"touchend",
			function (e) {
				var endx, endy;
				endx = e.changedTouches[0].pageX;
				endy = e.changedTouches[0].pageY;
				var direction = getDirection(startx, starty, endx, endy);
				switch (direction) {
					case 1:
						console.log("向上！");
						players();
						break;
					case 3:
						console.log("向左！");
						players();
						break;
				}
			},
			false,
		);
	</script>
</html>
