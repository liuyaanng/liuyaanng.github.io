---
title: Day17
date: 2019-07-31 10:05:48
tags: 实习 OpenCV
categories:
cover: false
mathjax: true
img: https://i.loli.net/2019/07/17/5d2e73bb14bd344648.png
---

# LBP算法

LBP（Local Binary Patterns，局部二值模式）是一种能够有效地度量和提取图像局部纹理信息的算子，具有旋转不变性和灰度不变性等显著的优点。它是人脸识别中一种提取特征的重要方法，具有对光照不敏感的特性，但是对姿态和表情的鲁棒性不强。
## 纹理

纹理是由于物体表面物理属性不同所引起的能够表示某个特定表面特征的灰度或颜色信息。纹理反映了图像灰度模式的空间分布，包含了图像的表面信息及其周围环境的关系。

## 基本的LBP算子

局部二值模式是一种灰度范围内的纹理描述方式。最初的LBP算子定义在一个3×3的窗口，以窗口中心像素点为阈值，将相邻的像素的灰度值与其进行比较，若周围的像素值大于中心点的值，则将该像素位置标记为1,否则为0.这样一个3×3邻域内的8个点可产生一个8-bit的无符号数，再按其位置赋予不同权重求和得一整数，即可得到该窗口的 **LBP** 值，并用这个数反映该区域的纹理信息。    
对比度分量C是邻域中所有大于和等于中心点像素的均值与所有小于中心点像素的均值之差。    
![](https://i.loli.net/2019/07/31/5d415779ca87257597.jpg)

基本的LBP算子最大的缺陷是只覆盖了一个固定半径范围内的小区域，改进的LBP算子，将3×3邻域扩展到任意邻域，用圆形邻域代替了正方形邻域，该算子允许在半径为R的圆形邻域内有任意多个像素点。
- 一个局部区域的纹理分布可假设为局部区域内像素灰度的联合分布密度
$$T = t(g_c,g_0, ....,g_{p-1})$$
$g_c$表示局部区域的中心点的灰度值,$g_p(p=0,1,...,p)$对应中心点周围等距分布的P个点
- 采用 **双线性插算法** 对没有完全落在像素位置的点计算灰度值。邻域内的$g_p$点的坐标可以表示为:
$$(x_p,y_p) = (x_c + Rcos(\frac{2\pi}{P}),y_c - Rsin(\frac{2\pi}{P}))$$
$(x_c,y_c)$表示中心点的坐标
- 将中心点$g_c$的值从邻域像素的灰度值$g_p$中减去，则局部区域的纹理可以用中心点和中心点与周边像素值之差的联合分布来表示:
$$T = t(g_c,g_0-g_c,....,g_{p-1}-g_c)$$
- 假设中心像素点$g_c$与周边点像素$g_p$的差值$g_p-g_c(p=0,1,...P)$独立于中心点$g_c$，则
$$T\approx t(g_c)(g_0-g_c,...,g_{p-1}-g_c)$$
- 实际上，$t(g_c)$只是描述了整个图像的亮度分布情况，而和图像的局部纹理无关，它不能为纹理分析提供任何有价值的信息
$$T\approx t(g_0-g_c,...,g_{p-1}-g_c)$$
- 差值的联合分布具有灰度平移不变性，即邻域中所有P+1个像素同时加上或减去某个值，其表征的纹理不变。
- 为了达到尺度不变的目的，只考虑差值的符号
$$T\approx t(s(g_0-g_c),...,s(g_p-g_c))$$

$$s(x)=\begin{cases}
1 , \quad &x > 0  \\\\
0 , &x \geqslant 0
\end{cases}
$$

上式得到了一个8位的二进制数，再对像素按不同位置用$2^p$进行加权求和，这样得到了一个与邻域像素点相关的唯一的 **LBP** 值，这个值称为 **模式**。这个值描述的是以$(x_c,y_c)$为中心的局部区域的纹理，可以表示为
$$LBP(x_c,y_c) = \sum_{p=0}^{P-1}s(g_p - g_c)2^P$$
上式意味着差值的符号转化成一个P-bit的二进制数，进而转化成为一个取值范围为0-$2^p$的离散的LBP值，或者说转化为一种LBP模式。
- 局部区域的灰度分布或纹理，可以用这个LBP值或LBP模式近似描述为:
$$T\approx t(LBP(x_c,y_c))$$
LBP算子对于任何单调的灰度变化具有鲁棒性，用符号$LBP_P^R$表示在半径为R的圆形邻域内有P个像素点$g_p(p=0,1,...,P)$的LBP算子
![](https://i.loli.net/2019/07/31/5d415779b84ac47631.jpg)

## LBP等价模式
### 定义
当某个局部二进制模式所对应的循环二进制数从０到１或从１到０最多有两次跳变时，该局部二进制模式所对应的二进制就称为一个等价模式类。比如00000000,11111111,10001111都是等价类。
### 检验方法
检验某种模式是否是等价模式的简单办法是将其和其移动一位后的二进制模式按位相减的绝对值求和
$$U(G_p) = |s(g_{p-1}-g_c)-s(g_0-g_c)|+\sum_{p=1}^{P-1}|s(g_p-g_c)-s(g_{p-1}-g_c)$$
若某种模式计算得到的 $U(G_p)$小于或等于２，则将其归于等价模式
![](https://i.loli.net/2019/07/31/5d415779c949196019.jpg)

## 旋转不变的LBP算子
### 定义
不断旋转圆形邻域得到一系列的初始定义的LBP值，取其最小值作为该邻域的LBP值，用公式表示为:
$$LBP_{P,R}^{ri} = min(ROR(LBP_{P,R}^{ri},i)|i=0,1,...,P-1)$$
$LBP^{ri}$表示旋转不变的LBP算子，$ROR(x,i)$函数为旋转函数，表示将x循环右移i(i<P)位。

### 性质
- 对于图像旋转，表现的更为鲁棒，并且LBP模式的种类进一步减少，使纹理识别更加容易。
- 丢失了方向信息
![](https://i.loli.net/2019/07/31/5d415779b8fed91298.jpg)

## 旋转不变的的等价模式
### 定义
将等价模式类进行旋转得到旋转不变的等价模式

$$LBP_{P,R}^{riu2} = \begin{cases}
\sum_{P=0}^{P-1}s(g_p-g_c), & U(G_p) \leq 2 \\\\
P + 1, & U(G_p) >2
\end{cases}
$$

其中$U(G_p)$表示0到1或1到0跳变的次数，$LBP^{riu2}$被称为旋转不变的等价模式

## 几种LBP算子的维数比较

 LBP  | 原始模式数 | 等价模式 | 旋转不变等价模式
:---: | :---: | :---: | :---:
$LBP_P^R$ | $2^P$ | $P(P-1) + 2$ | $P+1$
$LBP_8^1$ | 256 | 58(+1) | 9
$LBP_{16}^2$ | 65536 | 242(+1) | 17
$LBP_{24}^3$ | 16777216 | 554(+1) | 25



