---
title: Pandas 基础
top: false
cover: false
toc: true
mathjax: False
hidden: true
date: 2020-03-17 10:49:18
updatedate: 2020-03-17 10:49:18
img: https://i.loli.net/2020/03/17/dh2qsablfzx1E7R.png
password:
summary: Pandas 的快速入门笔记
tags:
- Python
- Pandas
categories:
- 笔记
---


## Pandas 基础
参考：[10min 入门Pandas](https://pandas.pydata.org/docs/getting_started/10min.html#min) 

导入：

```python
In [1]: import numpy as np
In [2]: import pandas as pd
```

### 创建对象

#### 1. 创建一个`Series`通过传递值的列表

```python
In [3]: s = pd.Series([1,2,3,np.nan,4,5])
In [4]: s
Out[4]:
0    1.0
1    2.0
2    3.0
3    NaN
4    4.0
5    5.0
dtype: float64
```

##### 2. DataFrame

- 通过传递带有日期时间的索引和带标签的列的numpy数组来创建

```python
In [5]: dates = pd.date_range('20200101', periods = 6)
In [6]: dates
Out[6]:
DatetimeIndex(['2020-01-01', '2020-01-02', '2020-01-03', '2020-01-04',
               '2020-01-05', '2020-01-06'],
              dtype='datetime64[ns]', freq='D')

In [7]: df = pd.DataFrame(np.random.randn(6,4), index = dates,
   ...:  columns = list('ABCD'))
In [8]: df
Out[8]:
                  A         B         C         D
2020-01-01 -1.325714 -0.485991  1.425164  0.111944
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-03 -0.508183  0.466789 -1.330469  0.534381
2020-01-04 -1.698448  0.092562  0.563688 -0.587796
2020-01-05  1.104307 -1.469510 -1.364106 -2.165353
2020-01-06 -0.009355 -0.491184  0.908148  0.021897
```

- 通过传递对象的字典来创建，这些对象可以转化为类似序列的对象

```python
In [11]: dff = pd.DataFrame({'A':1,
    ...:                     'B':pd.Timestamp('20200303'),
    ...:                     'C':np.array([3]*4, dtype = np.in
    ...: t32),
    ...:                     'D':pd.Series(1, index=list(range
    ...: (4)),dtype = 'float32'),
    ...:                     'E':pd.Categorical(["test","train
    ...: ","test","train"]),
    ...:                     'F':'foo'})
    ...:

In [12]: dff
Out[12]:
   A          B  C    D      E    F
0  1 2020-03-03  3  1.0   test  foo
1  1 2020-03-03  3  1.0  train  foo
2  1 2020-03-03  3  1.0   test  foo
3  1 2020-03-03  3  1.0  train  foo
```

结果的列具有不同的`dtype`

```python
In [13]: dff.dtypes
Out[13]:
A             int64
B    datetime64[ns]
C             int32
D           float32
E          category
F            object
dtype: object
```

### 2. 查看数据

- 查看顶部和底部行

```python
In [16]: df.head()
Out[16]:
                  A         B         C         D
2020-01-01 -1.325714 -0.485991  1.425164  0.111944
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-03 -0.508183  0.466789 -1.330469  0.534381
2020-01-04 -1.698448  0.092562  0.563688 -0.587796
2020-01-05  1.104307 -1.469510 -1.364106 -2.165353
In [17]: df.tail(3)
Out[17]:
                   A         B         C         D
2020-01-04 -1.698448  0.092562  0.563688 -0.587796
2020-01-05  1.104307 -1.469510 -1.364106 -2.165353
2020-01-06 -0.009355 -0.491184  0.908148  0.021897
```

- 查看索引和列

```python
In [18]: df.index
Out[18]:
DatetimeIndex(['2020-01-01', '2020-01-02', '2020-01-03', '2020-01-04',
               '2020-01-05', '2020-01-06'],
              dtype='datetime64[ns]', freq='D')
In [20]: df.columns
Out[20]: Index(['A', 'B', 'C', 'D'], dtype='object')
```

- `DataFrame.to_numpy`给出基础数据的Numpy形式

```python
In [21]: df.to_numpy()
Out[21]:
array([[-1.32571443, -0.48599075,  1.42516446,  0.11194363],
       [ 0.51837887, -1.08638321,  0.22993722,  0.11209583],
       [-0.50818274,  0.46678885, -1.33046943,  0.53438102],
       [-1.69844816,  0.0925617 ,  0.56368756, -0.58779561],
       [ 1.10430711, -1.46950994, -1.36410571, -2.16535338],
       [-0.00935469, -0.49118366,  0.90814807,  0.02189745]])
```

注意： `DataFrame.to_numpy()`在输出中不包括索引或标签

- `describe()`显示数据的快速统计摘要

```python
In [22]: df.describe()
Out[22]:
              A         B         C         D
count  6.000000  6.000000  6.000000  6.000000
mean  -0.319836 -0.495620  0.072060 -0.328805
std    1.074711  0.716905  1.168436  0.969198
min   -1.698448 -1.469510 -1.364106 -2.165353
25%   -1.121332 -0.937583 -0.940368 -0.435372
50%   -0.258769 -0.488587  0.396812  0.066921
75%    0.386445 -0.052076  0.822033  0.112058
max    1.104307  0.466789  1.425164  0.534381
```
- 转置数据

```python
In [24]: df.T
Out[24]:
   2020-01-01  2020-01-02  2020-01-03  2020-01-04  2020-01-05  2020-01-06
A   -1.325714    0.518379   -0.508183   -1.698448    1.104307   -0.009355
B   -0.485991   -1.086383    0.466789    0.092562   -1.469510   -0.491184
C    1.425164    0.229937   -1.330469    0.563688   -1.364106    0.908148
D    0.111944    0.112096    0.534381   -0.587796   -2.165353    0.021897
```

- 按轴排序

```python
In [26]: df.sort_index(axis = 1, ascending = False)
Out[26]:
                   D         C         B         A
2020-01-01  0.111944  1.425164 -0.485991 -1.325714
2020-01-02  0.112096  0.229937 -1.086383  0.518379
2020-01-03  0.534381 -1.330469  0.466789 -0.508183
2020-01-04 -0.587796  0.563688  0.092562 -1.698448
2020-01-05 -2.165353 -1.364106 -1.469510  1.104307
2020-01-06  0.021897  0.908148 -0.491184 -0.009355

In [27]: df.sort_index(axis = 0, ascending = False)
Out[27]:
                   A         B         C         D
2020-01-06 -0.009355 -0.491184  0.908148  0.021897
2020-01-05  1.104307 -1.469510 -1.364106 -2.165353
2020-01-04 -1.698448  0.092562  0.563688 -0.587796
2020-01-03 -0.508183  0.466789 -1.330469  0.534381
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-01 -1.325714 -0.485991  1.425164  0.111944
```

`axis = 1` 表示行
`axis = 0` 表示列
`ascending`默认为`True`,表示升序

- 按值排序

```python
In [28]:  df.sort_values(by='B')
Out[28]:
                   A         B         C         D
2020-01-05  1.104307 -1.469510 -1.364106 -2.165353
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-06 -0.009355 -0.491184  0.908148  0.021897
2020-01-01 -1.325714 -0.485991  1.425164  0.111944
2020-01-04 -1.698448  0.092562  0.563688 -0.587796
2020-01-03 -0.508183  0.466789 -1.330469  0.534381
```

### 3. 数据选择

#### 1. 一般选择

- 选择一个单列，产生一个`Series`,相当于`df.A`

```python
In [29]: df['A']
Out[29]:
2020-01-01   -1.325714
2020-01-02    0.518379
2020-01-03   -0.508183
2020-01-04   -1.698448
2020-01-05    1.104307
2020-01-06   -0.009355
Freq: D, Name: A, dtype: float64
```

- 对行进行切片

```python
In [30]: df[0:3]
Out[30]:
                   A         B         C         D
2020-01-01 -1.325714 -0.485991  1.425164  0.111944
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-03 -0.508183  0.466789 -1.330469  0.534381

In [31]: df['20200101':'20200105']
Out[31]:
                   A         B         C         D
2020-01-01 -1.325714 -0.485991  1.425164  0.111944
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-03 -0.508183  0.466789 -1.330469  0.534381
2020-01-04 -1.698448  0.092562  0.563688 -0.587796
2020-01-05  1.104307 -1.469510 -1.364106 -2.165353
```

#### 2. 通过标签选择

- 使用标签获取横截面

```python
In [32]: df.loc[dates[1]]
Out[32]:
A    0.518379
B   -1.086383
C    0.229937
D    0.112096
Name: 2020-01-02 00:00:00, dtype: float64
```

- 通过标签在多个轴上选择

```python
In [34]: df.loc[:,['A','C']]
Out[34]:
                   A         C
2020-01-01 -1.325714  1.425164
2020-01-02  0.518379  0.229937
2020-01-03 -0.508183 -1.330469
2020-01-04 -1.698448  0.563688
2020-01-05  1.104307 -1.364106
2020-01-06 -0.009355  0.908148

In [35]: df.loc[:,'A':'C']
Out[35]:
                   A         B         C
2020-01-01 -1.325714 -0.485991  1.425164
2020-01-02  0.518379 -1.086383  0.229937
2020-01-03 -0.508183  0.466789 -1.330469
2020-01-04 -1.698448  0.092562  0.563688
2020-01-05  1.104307 -1.469510 -1.364106
2020-01-06 -0.009355 -0.491184  0.908148
```

- 显示标签切片，两个端点都包括在内

```python
In [36]: df.loc['20200101':'20200104',['A','B']]
Out[36]:
                   A         B
2020-01-01 -1.325714 -0.485991
2020-01-02  0.518379 -1.086383
2020-01-03 -0.508183  0.466789
2020-01-04 -1.698448  0.092562
```

- 减小返回对象的尺寸

```python
In [37]: df.loc['20200101',['A','B']]
Out[37]:
A   -1.325714
B   -0.485991
Name: 2020-01-01 00:00:00, dtype: float64
```

- 获取标量值

```python
In [38]: df.loc[dates[0],'A']
Out[38]: -1.3257144329922794
```

- 快速访问标量

```python
In [39]: df.at[dates[0],'A']
Out[39]: -1.3257144329922794
```

#### 3. 通过位置选择

- 通过传递的整数的位置进行选择

```python
In [40]: df.iloc[3]
Out[40]:
A   -1.698448
B    0.092562
C    0.563688
D   -0.587796
Name: 2020-01-04 00:00:00, dtype: float64
```

- 通过整数切片

```python
In [41]: df.iloc[3:5,0:2]
Out[41]:
                   A         B
2020-01-04 -1.698448  0.092562
2020-01-05  1.104307 -1.469510
```

- 通过整数位置列表

```python
In [42]: df.iloc[[1,2,3],[0,2]]
Out[42]:
                   A         C
2020-01-02  0.518379  0.229937
2020-01-03 -0.508183 -1.330469
2020-01-04 -1.698448  0.563688
```

- 显式切片行

```python
In [43]: df.iloc[1:3,:]
Out[43]:
                   A         B         C         D
2020-01-02  0.518379 -1.086383  0.229937  0.112096
2020-01-03 -0.508183  0.466789 -1.330469  0.534381
```

- 显式切片列

```python
In [44]: df.iloc[:,2:4]
Out[44]:
                   C         D
2020-01-01  1.425164  0.111944
2020-01-02  0.229937  0.112096
2020-01-03 -1.330469  0.534381
2020-01-04  0.563688 -0.587796
2020-01-05 -1.364106 -2.165353
2020-01-06  0.908148  0.021897
```

- 显式地获取值

```python
In [45]: df.iloc[1,1]
Out[45]: -1.0863832145090018
```

- 快速访问标量

```python
In [46]: df.iat[1,1]
Out[46]: -1.0863832145090018
```







